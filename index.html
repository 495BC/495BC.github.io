<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Stats Page</title>
  <!-- IBM Plex Sans font -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Basic Reset & Body */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'IBM Plex Sans', sans-serif;
      background: #111;
      color: #fff;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }
    /* Custom Scrollbar Styles (WebKit & Firefox) */
    ::-webkit-scrollbar {
      width: 12px;
    }
    ::-webkit-scrollbar-track {
      background: #222;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #888;
      border-radius: 6px;
      border: 3px solid #222;
    }
    ::-webkit-scrollbar-thumb:hover {
      background-color: #aaa;
    }
    html {
      scrollbar-width: thin;
      scrollbar-color: #888 #222;
    }

    /* Background container behind everything */
    #bg-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-size: cover;
      background-position: center;
      transition: opacity 0.5s ease, background-position 0.5s ease-out;
      opacity: 1;
    }

    /* MAIN TITLE */
    .main-title {
      background-color: #000;
      text-align: center;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .main-title h1 {
      font-size: 2rem;
      color: #fff;
    }

    /* NAV BAR */
    .nav-bar {
      background-color: rgba(128,128,128,0.4);
      padding: 1rem;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-left: 10px;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    /************************************************
     * NEON BUTTON STYLES WITH CUSTOM COLORS
     ************************************************/
    .category-buttons {
      display: flex;
      gap: 1rem;
    }
    .category-buttons a {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      text-transform: uppercase;
      transition: 0.5s;
      letter-spacing: 4px;
      font-weight: bold;
      font-size: 1rem;
      border: 2px solid;
      border-color: var(--button-neon);
      height: 60px;
      aspect-ratio: 3 / 1;
    }
    .category-buttons a.qb {
      color: #8A2BE2;
      --button-neon: #8A2BE2;
    }
    .category-buttons a.wr {
      color: #03e9f4;
      --button-neon: #03e9f4;
    }
    .category-buttons a.db {
      color: #8B0000;
      --button-neon: #8B0000;
    }
    .category-buttons a.de {
      color: #FFA500;
      --button-neon: #FFA500;
    }
    .category-buttons a:hover {
      background: var(--button-neon);
      color: #fff;
      box-shadow: 0 0 5px var(--button-neon),
                  0 0 25px var(--button-neon),
                  0 0 50px var(--button-neon),
                  0 0 200px var(--button-neon);
      -webkit-box-reflect: below 1px linear-gradient(transparent, #0005);
    }

    /***********************************************
     * STAT PAGE SECTIONS
     ***********************************************/
    section {
      display: none;
      background-color: rgba(34,34,34,0.85);
      margin: 1rem auto;
      padding: 1rem;
      border-radius: 4px;
      max-width: 90%;
      transform: translateX(-50px);
      opacity: 0;
    }
    section h2 {
      margin-bottom: 1rem;
      color: #fff;
    }

    /* Container for the table */
    .list-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* We use grid for the heading row and each player row */
    .heading-row,
    .player-row {
      display: grid;
      gap: 5px;
      align-items: center;
      padding: 10px;
      border-radius: 5px;
    }
    .heading-row {
      background: rgba(0,0,0,0.7);
      font-weight: bold;
    }
    .player-row {
      background: rgba(0,0,0,0.5);
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    /* The "Rank" cell is the first column, 60px wide from the grid definition. */
    .rank-cell {
      text-align: center;
    }

    /* For heading cells and player cells */
    .heading-cell, .player-cell {
      padding: 0 10px;
      text-align: left;
    }

    /* For the rank cell in the data rows */
    .player-rank {
      text-align: center;
      font-weight: bold;
      background: #000;
      border-radius: 5px;
    }
    .top1 { border: 2px solid gold; }
    .top2 { border: 2px solid silver; }
    .top3 { border: 2px solid #cd7f32; }
    .other { border: 2px solid #444; }

    /* Animations */
    .fade-in-left {
      animation: fadeInLeft 0.5s ease forwards;
    }
    .fade-out-left {
      animation: fadeOutLeft 0.5s ease forwards;
    }
    @keyframes fadeInLeft {
      0% { opacity: 0; transform: translateX(-50px); }
      100% { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeOutLeft {
      0% { opacity: 1; transform: translateX(0); }
      100% { opacity: 0; transform: translateX(-50px); }
    }
  </style>
  <!-- Papa Parse via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>
  <!-- Background container -->
  <div id="bg-container"></div>

  <!-- MAIN TITLE -->
  <div class="main-title">
    <h1>Raider TC Stats</h1>
  </div>
  
  <!-- NAV BAR -->
  <div class="nav-bar">
    <div class="category-buttons">
      <a href="#" onclick="switchSection('qb-section')" class="qb">QB</a>
      <a href="#" onclick="switchSection('wr-section')" class="wr">WR</a>
      <a href="#" onclick="switchSection('db-section')" class="db">DB</a>
      <a href="#" onclick="switchSection('de-section')" class="de">DE</a>
    </div>
  </div>

  <!-- QB SECTION -->
  <section id="qb-section">
    <h2>Quarterback Stats</h2>
    <div class="list-container" id="qb-container"></div>
  </section>

  <!-- WR SECTION -->
  <section id="wr-section">
    <h2>Wide Receiver Stats</h2>
    <div class="list-container" id="wr-container"></div>
  </section>

  <!-- DB SECTION -->
  <section id="db-section">
    <h2>Defensive Back Stats</h2>
    <div class="list-container" id="db-container"></div>
  </section>

  <!-- DE SECTION -->
  <section id="de-section">
    <h2>Defensive End Stats</h2>
    <div class="list-container" id="de-container"></div>
  </section>

  <script>
    // Background images for each stat page
    const bgImages = {
      "qb-section": "https://wallpaperaccess.com/full/1840637.jpg",
      "wr-section": "https://wallpapercave.com/wp/cRNhjfm.jpg",
      "db-section": "https://wallpapercave.com/wp/wp2087757.jpg",
      "de-section": "https://w0.peakpx.com/wallpaper/803/1005/HD-wallpaper-las-vegas-raiders-american-football-team-black-stone-background-las-vegas-raiders-logo-grunge-art-nfl-american-football-usa-las-vegas-raiders-emblem.jpg"
    };

    // CSV links
    const CSV_QB_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQv20vUSyozLzoZmyfQGHiPHx0JNlnZoZlGxa6K9ZjdCPhHdjWXb8ToDvebBaxRz3CJfWPjj0bI18Zy/pub?output=csv";
    const CSV_WR_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRpAk3lRX606aOmjB9zgpHaQzxlKc-stoJRD-1DW2UjkeDUIpgfvorq1qfedCsOEc9Zg_8Z6RxCJV9x/pub?output=csv";
    const CSV_DB_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4EemaFNDP_y7-mnuKQdES6iAoNCAKpeWD0kbDsY_geFPbttzs0umb5Ja-Xg2fu8hpIE3uhP3fXdIO/pub?output=csv";
    const CSV_DE_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuB1-17W9_4DvGrinp3ovMjspVwLlVm6sL44sQM1yZY-EttTSKCVfazjlnmaglwf_bN0Acq0XOmIw8/pub?output=csv";

    // We define the # of CSV columns for each position 
    // (excluding rank) so we can set grid-template-columns properly:
    const colCountQB = 10; // Example: 10 columns for QB
    const colCountWR = 9;  // Example: 9 columns for WR
    const colCountDB = 8;  // Example: 8 columns for DB
    const colCountDE = 8;  // Example: 8 columns for DE

    // Section IDs
    const sections = ["qb-section", "wr-section", "db-section", "de-section"];

    // On DOM load, build all pages & show QB by default
    window.addEventListener('DOMContentLoaded', () => {
      fetchAndBuildList(CSV_QB_LINK, "qb-container", colCountQB);
      fetchAndBuildList(CSV_WR_LINK, "wr-container", colCountWR);
      fetchAndBuildList(CSV_DB_LINK, "db-container", colCountDB);
      fetchAndBuildList(CSV_DE_LINK, "de-container", colCountDE);
      showSection("qb-section");
    });

    // Switch sections
    function switchSection(newSectionId) {
      showSection(newSectionId);
    }

    function showSection(sectionId) {
      updateBackground(sectionId);
      sections.forEach(id => {
        let secEl = document.getElementById(id);
        if (id === sectionId) {
          secEl.style.display = "block";
          secEl.classList.add("fade-in-left");
        } else {
          if (secEl.style.display === "block") {
            secEl.classList.remove("fade-in-left");
            secEl.classList.add("fade-out-left");
            secEl.addEventListener("animationend", function handler() {
              secEl.style.display = "none";
              secEl.classList.remove("fade-out-left");
              secEl.removeEventListener("animationend", handler);
            });
          }
        }
      });
    }

    // Fade out/in background
    function updateBackground(sectionId) {
      const bgContainer = document.getElementById("bg-container");
      bgContainer.style.opacity = 0;
      setTimeout(() => {
        bgContainer.style.backgroundImage = `url('${bgImages[sectionId]}')`;
        bgContainer.style.opacity = 1;
      }, 500);
    }

    // Parallax effect
    window.addEventListener('scroll', () => {
      const scrollPos = window.scrollY;
      const factor = 0.3;
      const bgContainer = document.getElementById("bg-container");
      bgContainer.style.backgroundPosition = `center ${-scrollPos * factor}px`;
    });

    /**
     * Build a grid-based table from the CSV.
     * @param {string} csvLink  - The CSV URL
     * @param {string} containerId - The ID of the container to fill
     * @param {number} colCount - How many CSV columns (excluding rank)
     */
    function fetchAndBuildList(csvLink, containerId, colCount) {
  fetch(csvLink)
    .then(response => response.text())
    .then(csvText => {
      const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
      const data = results.data;            // row objects
      let fields = results.meta.fields;     // original column headers

      // 1) Remove the second-last column or any you don't want
      // 2) Ensure "STARs" is last
      fields = customReorderFields(fields);

      // Then continue as usual
      const container = document.getElementById(containerId);
      container.innerHTML = "";

      // The grid template: 60px for rank, plus as many columns as we have in `fields`
      const gridTemplate = `60px repeat(${fields.length}, 1fr)`;

      // Build heading row
      const headingRow = document.createElement("div");
      headingRow.classList.add("heading-row", "fade-in-left");
      headingRow.style.gridTemplateColumns = gridTemplate;
      headingRow.style.animationDelay = "0s";

      // Rank heading
      const rankHeading = document.createElement("div");
      rankHeading.classList.add("heading-cell", "rank-cell");
      rankHeading.textContent = "Rank";
      headingRow.appendChild(rankHeading);

      // Create heading cells in the new order
      fields.forEach(fieldName => {
        const cell = document.createElement("div");
        cell.classList.add("heading-cell");
        cell.textContent = fieldName;
        headingRow.appendChild(cell);
      });
      container.appendChild(headingRow);

      // Build each data row
      data.forEach((rowObj, index) => {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("player-row", "fade-in-left");
        rowDiv.style.gridTemplateColumns = gridTemplate;
        rowDiv.style.animationDelay = ((index + 1) * 0.1) + "s";

        // Rank cell
        const rankDiv = document.createElement("div");
        rankDiv.classList.add("player-rank");
        rankDiv.textContent = index + 1;
        if (index === 0)      rankDiv.classList.add("top1");
        else if (index === 1) rankDiv.classList.add("top2");
        else if (index === 2) rankDiv.classList.add("top3");
        else                  rankDiv.classList.add("other");
        rowDiv.appendChild(rankDiv);

        // Create cells in the new order
        fields.forEach(fieldName => {
          const cellDiv = document.createElement("div");
          cellDiv.classList.add("player-cell");
          let rawValue = rowObj[fieldName] || "";

          // If the column is "STARs", convert numeric to star emojis
          if (fieldName.toUpperCase() === "STARS") {
            const ratingValue = parseFloat(rawValue) || 0;
            cellDiv.textContent = "â­".repeat(Math.floor(ratingValue));
          } else {
            cellDiv.textContent = rawValue;
          }
          rowDiv.appendChild(cellDiv);
        });

        container.appendChild(rowDiv);
      });
    })
    .catch(err => console.error("Error fetching CSV:", err));
}

function customReorderFields(fields) {
  // 1) Remove "SomeColumn" or the second-last column you don't want
  let newFields = fields.filter(f => f !== "SomeColumn");

  // 2) Move "STARs" to the end
  const starIndex = newFields.findIndex(f => f.toUpperCase() === "STARS");
  if (starIndex >= 0) {
    const removed = newFields.splice(starIndex, 1);
    newFields.push(removed[0]);
  }
  return newFields;
}

  </script>
</body>
</html>
